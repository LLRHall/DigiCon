<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="/static/assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>$APPNAME by $TEAMNAME</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="/static/assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="/static/assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="/static/assets/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="/static/assets/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="/static/assets/css/pe-icon-7-stroke.css" rel="stylesheet">
    <link href="/static/assets/css/index.css" rel="stylesheet">
    <!-- <link href="/static/assets/css/loader.css" rel="stylesheet"> -->
    <!-- intro.js-->
    <link href="/static/assets/css/introjs.css" rel="stylesheet">
    <script src="/static/assets/js/jquery.3.2.1.min.js" type="text/javascript"></script>
    <script src="/static/assets/js/md5.js" type="text/javascript"></script>

</head>
<body>

<div class="wrapper">
    {% include 'side-nav.html' %}
    <div class="main-panel">
        {% include 'navbar.html' %}
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                  <!--   <output id="list"></output>
                    <form id="upload-file" method="post" enctype="multipart/form-data">
                        <fieldset>
                            <label for="file">Select Image(s)</label>
                            <input name="file" type="file">
                        </fieldset>
                        <fieldset>
                            <button id="upload-file-btn" type="button">Upload</button>
                        </fieldset>
                    </form> -->

                        <div class="col-md-1"></div>
                        <div class="col-md-10">
                            <output id="list" class="box"></output>    
                            <div class="drop">
                                <div class="cont">
                                    <i class="fa fa-cloud-upload"></i>
                                    <div class="tit">
                                        Drag & Drop
                                    </div>
                                      <div class="desc">
                                        your files to Assets, or
                                    </div>
                                    <div class="browse">
                                        click here to browse
                                    </div>
                                </div>

                                <form id="upload-file" method="post" enctype="multipart/form-data">
                                    <input id="files" multiple="true" name="file[]" type="file" />
                                </form>
                            </div>
                        </div>
                        <div class="col-md-1"></div>
                </div>

            </div>
        </div>

        {% include 'footer.html' %}


    </div>
</div>


</body>

    <!--   Core JS Files   -->

	<script src="/static/assets/js/bootstrap.min.js" type="text/javascript"></script>

	<!--  Charts Plugin -->
	<script src="/static/assets/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="/static/assets/js/bootstrap-notify.js"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="/static/assets/js/light-bootstrap-dashboard.js?v=1.4.0"></script>

    <!-- intro.js-->
    <script src="/static/assets/js/intro.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="/static/assets/js/demo.js"></script>


    <script type="text/javascript">

        // String format
        // First, checks if it isn't implemented yet.
        if (!String.prototype.format) {
          String.prototype.format = function() {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function(match, number) {
              return typeof args[number] != 'undefined'
                ? args[number]
                : match
              ;
            });
          };
        }


        $('#reloadbutton').hide()

        $(document).ready(function(){
            $(".drop").addClass("animated fadeIn")
            var drop = $(".drop");
            drop.on('dragenter', function (e) {
                $(".drop").css({
                    "border": "4px dashed #09f",
                    "background": "rgba(0, 153, 255, .05)"
                });
                $(".cont").css({
                    "color": "#09f"
                });
            }).on('dragleave dragend mouseout drop', function (e) {
                $(".drop").css({
                    "border": "3px dashed #DADFE3",
                    "background": "transparent"
                });
                $(".cont").css({
                    "color": "#8E99A5"
                });
            });



            function handleFileSelect(evt) {
                var files = evt.target.files; // FileList object
                // var file_ids = [];
                // Loop through the FileList and render image files as thumbnails.
                for (var i = 0, f; f = files[i]; i++) {


                    // Only process image files.
                    if (!f.type.match('image.*')) {
                        continue;
                    }
                    $(".drop").attr("hidden",true);
                    var reader = new FileReader();

                    // Closure to capture the file information.
                    reader.onload = (function(theFile) {
                        // file_ids[i] = md5(theFile.name);
                        
                        // file_id = file_ids[i];
                        // setTimeout(() => {console.log("test")},3000);
                        return function(e) {
                            // Render thumbnail.
                            var div = document.createElement('div');

                            file_id = md5(theFile.name);
                            // var filename = theFilen.ame.substring(0, data.lastIndexOf('.'));
                            var innerHTML = `
                                <div class='card card1' id='{0}'>
                                    
                                    <div class='card-body'>
                                        <div style='display: flex; align-items: center; ' >
                                            <div class='columns'>
                                            <img class='thumb' src='{1}' title='{2}'/>
                                            </div>
                                            <div class='columns'>
                                            <img src='/static/assets/loader.svg' class='loader'/>
                                            <img src='/static/assets/processed.svg' class='processed' hidden=true/>

                                            </div>
                                            <div class='columns'>
                                            <a download target="_blank" href="/static/files/results/{2}" class="btn btn-sq-lg btn-success" disabled>
                                              <i class="fa fa-file-text"></i><br/>
                                              Download Results <br> Document
                                            </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `

                            div.innerHTML = innerHTML.format(file_id, e.target.result, escape(theFile.name))

                            document.getElementById('list').insertBefore(div, null);

                        };



                    })(f);
                    // $.get("/static/assets/loader.html", function (data) {
                    //                 $("#"+file_id).html(data);
                    //                 console.log(data);
                    //          });


                    // console.log(f);

                    // Read in the image file as a data URL.
                    reader.readAsDataURL(f);

                }

                var form_data = new FormData($('#upload-file')[0]);


                $.ajax({
                    type: 'POST',
                    url: '/uploadfile',
                    data: form_data,
                    contentType: false,
                    cache: false,
                    processData: false,
                    async: false,
                    success: function(data) {
                        if (data == 'success') {
                            for (var i = files.length - 1; i >= 0; i--) {
                                $.get('/processfile/' + files[i].name, function(filename, status) {
                                    console.log('Done with ', filename);
                                    var file_id = md5(filename);
                                    console.log(file_id+"    "+filename);
                                    $("#"+file_id+" .loader").attr("hidden",true);
                                    $("#"+file_id+" .processed").removeAttr("hidden");
                                    $("#"+file_id+" .processed").removeAttr("disabled");

                                })
                            }
                        } else {
                            alert('Error in file upload. Please try again!');
                        }
                        // filename = data.substring(0, data.lastIndexOf('.'));
                        // alert('file '+ filename + ' uploaded')
                    },
                });


                $('#reloadbutton').show()

            }


            $('#files').change(handleFileSelect);

            // // $('#upload-file-btn').click(function() {
            // //         // Loop through the FileList and render image files as thumbnails.
            // //     for (var i = 0, f; f = $('#upload-file')[i]; i++) {

            // //         // var filename = $('#upload-file').val().split('\\').pop();
            // //         var form_data = new FormData($('#upload-file')[i]);
            // //         // console.log(form_data.name);
            // //         var span = document.createElement('span');
            // // //                 span.innerHTML = ['<div class="row"><img class="thumb" src="', e.target.result,
            // // //                         '" title="', escape(theFile.name), '"/></div>'].join('');
            // // //                 document.getElementById('list').insertBefore(span, null);
            // //         $.ajax({
            // //             type: 'POST',
            // //             url: '/uploadfile',
            // //             data: form_data,
            // //             contentType: false,
            // //             cache: false,
            // //             processData: false,
            // //             async: false,
            // //             success: function(data) {
            // //                 console.log(data);
            // //                 filename = data.substring(0, data.lastIndexOf('.'));
            // //                 alert('file '+ filename + ' uploaded')
            // //             },
            // //         });
            // //     }

            // });


        });
    </script>


</html>
